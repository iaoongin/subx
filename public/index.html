<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SubX 订阅管理</title>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>🚀 SubX 订阅管理</h1>
      <p>轻松管理您的订阅链接，支持实时添加、编辑和删除</p>
      <div class="header-actions">
        <button class="header-action-btn" onclick="openConfigModal()">
          ⚙️ 系统配置
        </button>
        <button class="logout-btn" onclick="logout()">🚪 登出</button>
      </div>
    </div>

    <div id="message"></div>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="totalCount">0</div>
        <div class="stat-label">总订阅数</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="activeCount">0</div>
        <div class="stat-label">活跃订阅</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="inactiveCount">0</div>
        <div class="stat-label">已禁用</div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="action-btn action-btn-config" onclick="openConfigModal()">
        ⚙️ 系统配置
      </button>
    </div>

    <div class="subscriptions-section">
      <div class="section-header">
        <h2>📋 订阅列表</h2>
        <div style="display: flex; gap: 10px;">
          <button class="section-action-btn" onclick="subscriptionManager.previewSubscription()">
            👀 预览订阅
          </button>
          <button class="section-action-btn" onclick="subscriptionManager.refreshSubscription()">
            🔄 刷新缓存
          </button>
          <button class="section-action-btn" onclick="openAddModal()">
            ➕ 添加订阅
          </button>
        </div>
      </div>
      <div id="subscriptionsList">
        <div class="loading">正在加载订阅列表...</div>
      </div>
    </div>
  </div>

  <!-- 系统配置模态框 -->
  <div id="configModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">⚙️ 系统配置</h2>
        <button class="close" onclick="closeModal('configModal')">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form id="configForm" class="modal-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="modal-token">访问令牌 (Token) *</label>
              <input type="text" id="modal-token" required />
            </div>
            <div class="form-group">
              <label for="modal-fileName">文件名称 (FileName) *</label>
              <input type="text" id="modal-fileName" required />
            </div>
            <div class="form-group">
              <label for="modal-subUpdateTime">订阅更新间隔（小时）</label>
              <input type="number" id="modal-subUpdateTime" min="1" max="168" required />
            </div>
            <div class="form-group">
              <label for="modal-total">总流量 (TB)</label>
              <input type="number" id="modal-total" min="1" required />
            </div>
            <div class="form-group">
              <label for="modal-botToken">Telegram Bot Token</label>
              <input type="text" id="modal-botToken" placeholder="可选" />
            </div>
            <div class="form-group">
              <label for="modal-chatId">Telegram Chat ID</label>
              <input type="text" id="modal-chatId" placeholder="可选" />
            </div>
            <div class="form-group">
              <label for="modal-adminPassword">管理员密码</label>
              <input type="password" id="modal-adminPassword" required />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-modal-secondary" onclick="configManager.resetConfig()">
          重置默认值
        </button>
        <button type="button" class="btn-modal btn-modal-secondary" onclick="closeModal('configModal')">
          取消
        </button>
        <button type="submit" form="configForm" class="btn-modal btn-modal-primary">
          保存配置
        </button>
      </div>
    </div>
  </div>

  <!-- 添加订阅模态框 -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">➕ 添加新订阅</h2>
        <button class="close" onclick="closeModal('addModal')">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form id="addForm" class="modal-form">
          <div class="form-group">
            <label for="modal-type">类型 *</label>
            <select id="modal-type" required>
              <option value="subscription">订阅链接</option>
              <option value="node">单节点</option>
            </select>
          </div>
          <div class="form-group">
            <label for="modal-name">名称 *</label>
            <input type="text" id="modal-name" required placeholder="请输入名称" />
          </div>
          <div class="form-group">
            <label for="modal-url">订阅链接 *</label>
            <input type="url" id="modal-url" required placeholder="https://example.com/subscribe" />
          </div>
          <div class="form-group">
            <label for="modal-description">描述</label>
            <textarea id="modal-description" placeholder="请输入订阅描述（可选）"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-modal-secondary" onclick="closeModal('addModal')">
          取消
        </button>
        <button type="submit" form="addForm" class="btn-modal btn-modal-primary">
          添加订阅
        </button>
      </div>
    </div>
  </div>

  <!-- 编辑订阅模态框 -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">✏️ 编辑订阅</h2>
        <button class="close" onclick="closeModal('editModal')">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form id="editForm" class="modal-form">
          <input type="hidden" id="edit-id" />
          <div class="form-group">
            <label for="edit-type">类型 *</label>
            <select id="edit-type" required>
              <option value="subscription">订阅链接</option>
              <option value="node">单节点</option>
            </select>
          </div>
          <div class="form-group">
            <label for="edit-name">名称 *</label>
            <input type="text" id="edit-name" required />
          </div>
          <div class="form-group">
            <label for="edit-url">订阅链接 *</label>
            <input type="url" id="edit-url" required />
          </div>
          <div class="form-group">
            <label for="edit-description">描述</label>
            <textarea id="edit-description"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-modal-secondary" onclick="closeModal('editModal')">
          取消
        </button>
        <button type="submit" form="editForm" class="btn-modal btn-modal-primary">
          保存修改
        </button>
      </div>
    </div>
  </div>

  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">处理中...</div>
  </div>

  <script src="index.js"></script>
</body>

</html>